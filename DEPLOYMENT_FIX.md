# Deployment Fix Instructions

This document outlines the steps required to fix the "white screen" issue and missing styles/scripts on the VPS. The issue is caused by incorrect file permissions and strict Content Security Policy (CSP) settings in Nginx.

## 1. Fix File Permissions

The web server (likely `www-data`) needs permission to read the built assets. Currently, they are owned by `root`.

Run the following command on your VPS:

```bash
sudo chown -R www-data:www-data /var/www/otorrinonet/public/build
```

## 2. Configure Nginx CSP

The current Nginx configuration is blocking the loading of CSS and JavaScript files generated by Vite. You need to update your Nginx site configuration to allow these assets.

1. Open your Nginx configuration file (e.g., `/etc/nginx/sites-available/otorrinonet` or `/etc/nginx/sites-enabled/default`).
2. Add or update the `add_header Content-Security-Policy` directive inside the `server` block.

### Production Configuration (Recommended)

Use this configuration for your live site. It is secure and allows only trusted resources from the same origin (`'self'`), blocking unsafe inline scripts/styles and `eval`.

```nginx
server {
    # ... existing configuration ...

    root /var/www/otorrinonet/public;
    index index.php index.html index.htm;

    # Secure CSP for Production
    # default-src 'self': Only allow resources from the same domain by default.
    # script-src 'self': Only allow scripts from the same domain (no inline scripts, no eval).
    # style-src 'self': Only allow stylesheets from the same domain (no inline styles).
    add_header Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self' data:; font-src 'self';";

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # ... PHP handling ...
}
```

### Development/Debugging Configuration

You may temporarily enable this permissive configuration if you are debugging issues or if your build process has failed to extract all styles/scripts correctly. **Remove these allowances after fixing the underlying issue.**

```nginx
    # Permissive CSP for Debugging
    # Includes 'unsafe-inline' and 'unsafe-eval' to identify if strict rules are breaking the site.
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self';";
```

1. Test and reload Nginx:

```bash
sudo nginx -t
sudo systemctl reload nginx
```

## 3. Verify

1. Clear your browser cache.
2. Reload the page.
3. The styles should now load correctly.
